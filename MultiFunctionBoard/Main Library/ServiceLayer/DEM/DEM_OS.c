/*
*-----------------------------------------------------------------------------------------------------------------
* Filename         : DEM_OS.c
* Version          : 0.0.0
* Created          : 2021/04/10
* Author           : Ayman Ashraf
*-----------------------------------------------------------------------------------------------------------------
*
*-----------------------------------------------------------------------------------------------------------------
*/




/*
*-----------------------------------------------------------------------------------------------------------------*
*---------------------------------------------------------------------------------------------------------------
*                                                   # I N C L U D E S
*---------------------------------------------------------------------------------------------------------------
*-----------------------------------------------------------------------------------------------------------------*
*/
/*
 ==================================================================================================================
 *                                                  Environment Include
 ==================================================================================================================
 */
/*
 ==================================================================================================================
 *                                                  Application Include
 ==================================================================================================================
 */
#include "DEM_CORE.h"
#include "DEM_OS.h"
#include "OS.h"
#include "COMPILER_EXT.h"
#include "UTILITY.h"
#include "Verbose.h"
/*
*-----------------------------------------------------------------------------------------------------------------*
*                                                     INCLUDES
*******************************************************************************************************************/



/*
*-----------------------------------------------------------------------------------------------------------------*
*---------------------------------------------------------------------------------------------------------------
*                                                   # D E F I N E S
*---------------------------------------------------------------------------------------------------------------
*-----------------------------------------------------------------------------------------------------------------*
*/
#define MAX_SERIAL_QUEUED_EVENTS        20U
/*
*-----------------------------------------------------------------------------------------------------------------*
*---------------------------------------------------------------------------------------------------------------
*                                                # L O C A L  M A C R O S
*---------------------------------------------------------------------------------------------------------------
*-----------------------------------------------------------------------------------------------------------------*
*/


/*
*-----------------------------------------------------------------------------------------------------------------*
*---------------------------------------------------------------------------------------------------------------
*                                             L O C A L  D A T A   T Y P E S
*---------------------------------------------------------------------------------------------------------------
*-----------------------------------------------------------------------------------------------------------------*
*/
static Mailbox_Handle objLogMailboxHandler;
/*
*-----------------------------------------------------------------------------------------------------------------*
*---------------------------------------------------------------------------------------------------------------
*                                              L O C A L   V A R I A B L E S
*---------------------------------------------------------------------------------------------------------------
*-----------------------------------------------------------------------------------------------------------------*
*/

/*
*-----------------------------------------------------------------------------------------------------------------*
*---------------------------------------------------------------------------------------------------------------
*                                                L O C A L   T A B L E S
*---------------------------------------------------------------------------------------------------------------
*-----------------------------------------------------------------------------------------------------------------*
*/

/*
*-----------------------------------------------------------------------------------------------------------------*
*---------------------------------------------------------------------------------------------------------------
*                                    L O C A L  F U N C T I O N   P R O T O T Y P E S
*---------------------------------------------------------------------------------------------------------------
*-----------------------------------------------------------------------------------------------------------------*
*/
static void DEM_vProcessTask(INT32U u32Argument1, INT32U u32Argument2);
/*
*-----------------------------------------------------------------------------------------------------------------*
*---------------------------------------------------------------------------------------------------------------
*                                              G L O B A L   V A R I A B L E S
*---------------------------------------------------------------------------------------------------------------
*-----------------------------------------------------------------------------------------------------------------*
*/

/*
*-----------------------------------------------------------------------------------------------------------------*
*---------------------------------------------------------------------------------------------------------------
*                                             G L O B A L   F U N C T I O N S
*---------------------------------------------------------------------------------------------------------------
*-----------------------------------------------------------------------------------------------------------------*
*/
/* START FUNCTION DESCRIPTION ******************************************************************************************
DEM_vInitOS                                         <DEM_CORE>

SYNTAX:         void DEM_vInitOS(void)

DESCRIPTION :   Start here

PARAMETER1  :   Start here

RETURN VALUE:   Start here

Note        :   Start here

END DESCRIPTION *******************************************************************************************************/
void DEM_vInitOS(void)
{
    Task_Params     PrintTaskParameter;
    Task_Handle     pPrintTaskHandler;
    Mailbox_Params  objLogMailboxParameter;

    /* create task Print engine Instance*/
    Task_Params_init(&PrintTaskParameter);
    PrintTaskParameter.stackSize                = 512;
    PrintTaskParameter.priority                 = 2;
    PrintTaskParameter.instance->name           = "DEM Process Task";
    pPrintTaskHandler = Task_create(DEM_vProcessTask, &PrintTaskParameter, STD_NULL);
    (void)pPrintTaskHandler;
    /* create a Mailbox Instance */
    Mailbox_Params_init(&objLogMailboxParameter);
    objLogMailboxParameter.instance->name = "Serial log Q";
    objLogMailboxHandler = Mailbox_create(sizeof(DEM_strEventInfoType),\
                                          MAX_SERIAL_QUEUED_EVENTS,\
                                          &objLogMailboxParameter,\
                                          STD_NULL);
}
/* START FUNCTION DESCRIPTION ******************************************************************************************
DEM_srQueueSerialLogEvent                             <DEM_OS>

SYNTAX:         StdReturnType DEM_srQueueSerialLogEvent(strEventInfoType const *pstrEventInfoType);

DESCRIPTION :   This function is used to Q log event into Serial log event mailbox

PARAMETER1  :  Pointer to the activity which would be queued

RETURN VALUE:  E_OK             : if the queuing  process success
               E_NOT_OK         : if the queuing  process  fail

Note        :

END DESCRIPTION *******************************************************************************************************/
StdReturnType DEM_srQueueLogEvent(DEM_strEventInfoType const *pstrEventInfoType)
{
    BOOLEAN       bPostStatus;
    StdReturnType srQueueStatus = E_OK;

    /*enqueue message*/
    bPostStatus = Mailbox_post(objLogMailboxHandler, (xdc_Ptr)pstrEventInfoType, BIOS_NO_WAIT);
    if(bPostStatus == STD_FALSE)
    {
        /*
            mVerboseNoLine(RED_TEXT);
            mVerboseNoLine("\ncan't add to serial log Q");
            mVerboseNoLine(WHITE_TEXT);
            srQueueStatus = E_NOT_OK;
        */
    }
    return srQueueStatus;
}
/* START FUNCTION DESCRIPTION ******************************************************************************************
DEM_srDequeueSerialLogEvent                          <DEM_OS>

SYNTAX:         StdReturnType DEM_srDequeueLogEvent(strEventInfoType **pstrEventInfoType)

DESCRIPTION :   pend the log mailbox for event

PARAMETER1  :   address of pointer to the log event

RETURN VALUE:   E_OK             : if the dequeue process is success
                E_NOT_OK         : if something wrong occurs

Note        :

END DESCRIPTION *******************************************************************************************************/
StdReturnType DEM_srDequeueLogEvent(DEM_strEventInfoType *pstrEventInfoType)
{
    StdReturnType     srQueueStatus = E_OK;
    BOOLEAN           bPendingStatus;

    bPendingStatus = Mailbox_pend(objLogMailboxHandler, pstrEventInfoType, OS_WAIT_FOREVER);
    if(bPendingStatus == STD_FALSE)                               /* no error encountered in the mail box */
    {
        pstrEventInfoType = STD_NULL;
        srQueueStatus = E_NOT_OK;
    }

    return srQueueStatus;
}
/* START FUNCTION DESCRIPTION ******************************************************************************************
DEM_vProcessTask                               <DEM_CORE>

SYNTAX:         static void DEM_vMonitorTask(INT32U u32Argument1, INT32U u32Argument2);

DESCRIPTION :   Start here

PARAMETER1  :   Start here

RETURN VALUE:   Start here

Note        :

END DESCRIPTION *******************************************************************************************************/
static void DEM_vProcessTask(INT32U u32Argument1, INT32U u32Argument2)
{
    (void)u32Argument1;
    (void)u32Argument2;
    while(1)
    {
        DEM_vPrintEventTask();
    }
}
/*
*-----------------------------------------------------------------------------------------------------------------*
*---------------------------------------------------------------------------------------------------------------
*                                               L O C A L   F U N C T I O N S
*---------------------------------------------------------------------------------------------------------------
*-----------------------------------------------------------------------------------------------------------------*
*/

/*
*-----------------------------------------------------------------------------------------------------------------*
*                                                      MODULE END
*-----------------------------------------------------------------------------------------------------------------*
*/
